# Working with IIIF resources
Cineast supports performing extraction on IIIF resources hosted on compatible media servers. During the feature extraction process, Cineast will automatically download all the resources specified in the extraction config file to a folder on the local filesystem and perform extraction on it.

## IIIF Extraction Configuration

To extract features from IIIF resources for use with Cineast, an extraction job config JSON file must be used. This file must list out various IIIF job specific parameters along with other general parameters that are required by all types of Cineast extraction jobs (Extractors, Exporters, Database etc). For more information regarding configuration of an extraction job in general, please refer to [Extraction Configuration](https://github.com/vitrivr/cineast/wiki/Extraction-Configuration). We will be using a shortened version of an IIIF specific example configuration file to explain what the diffenent parameters mean. The complete config file can be found [here](https://github.com/vitrivr/cineast/wiki/iiif_extraction_config.json).


```
{
  "input": {
    "path": "path/to/download/directory",
    ...
    "iiif": {
      "imageApiUrl": "...",
      "imageApiVersion": "2.1.1",
      "keepImagesPostExtraction": true,
      ...
      "items": [...],
      ],
      "manifestUrl": "..."
    }
  },
  "metadata": [
    {
      "name": "IIIFMetaDataExtractor"
    }
  ]
}

```

### `"input"` > `"path"`
The path parameter controls where the IIIF resources will be saved when they are downloaded before extraction begins. This value will only be used if `keepImagesPostExecution` is set to `true`. If a `path` has not been specified, Cineast will store the resources in a directory named `iiif-media-${System.currentTimeMillis()}`.

### `"iiif"` > `"imageApiUrl"`
Optional parameter used to set the path of the Image API resource, If a single Image API resource is required then this can contain the complete path pointing to the resource (baseUrl and identifier). If multiple resources have to be downloaded from the same server, then this should contain the common baseUrl shared by all the resources. [More info](#image-api)

### `"iiif"` > `"imageApiVersion"`
Optional parameter used to specifiy the version of the Image API supported by the server. If the `ImageApiVersion` is not specified then Cineast will automatically try to determine the highest version of the API supported by the server. Thus, it is okay to omit this if the version is not known or if the resources are available at varying API levels.

### `"iiif"` > `"keepImagesPostExtraction"`
By default, Cineast will delete the IIIF resources post extraction. If this parameter's value is set to `true` then instead of deleting these resources, Cineast will save them to the directory specified at `"input"` > `"path"`. 

## Image API
Cineast can donwload indivual image resources in any region, size, rotation, format and quality; provided that these parameters are supported by the server.

Image API versions supported by Cineast:
- 2.1.1
- 3.0

### Configuring an Image API Extraction job

An Image API job can be configured in the `iiif` object block of the configuration file. Here is an extract from the [example configuration file](https://github.com/vitrivr/cineast/wiki/iiif_extraction_config.json).

```
"imageApiUrl": "https://example.com",
"imageApiVersion": "2.1.1",
"rotation": 10,
"items": [
    {
        "identifier": "image1",
        "region": "square"
    },
    {
        "identifier": "image2",
        "rotation": 180,
        "quality": "bitonal",
        "format": "png"
    }
]
```

The Image API URL's generated by Cineast based on this config are:
- https://example.com/image1/square/full/10/default.jpg
- https://example.com/image2/full/full/180/bitonal.png

If the `ImageApiVersion` is not specified then Cineast will automatically try to determine the highest version of the API supported by the server.


## Presentation API
Cineast can donwload all image resources in all the canvases of a manifest file. All donwloaded images will be saved to a folder named after the manifest inside the `path` specified in the config file.

Presentation API versions supported by Cineast:
- 2.1.1

### Configuring a Presentation API Extraction job

A Presentation API job can be configured in the `manifestUrl` variable in the `iiif` object block of the configuration file. Here is an extract from the [example configuration file](https://github.com/vitrivr/cineast/wiki/iiif_extraction_config.json).

```
"manifestUrl": "https://example.com/manifests/identifier/manifest.json"
```

Cineast will parse this manifest file and start downloading all images in the various `canvases` of the `sequences` object.
